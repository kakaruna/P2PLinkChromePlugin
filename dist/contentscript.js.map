{"version":3,"file":"contentscript.js","sources":["../src/contentscript/index.ts"],"sourcesContent":["import { Result } from \"../shared\";\n\nexport class Content {\n    private ed2k_regex: RegExp = /ed2k:\\/\\/\\|file\\|.+?\\//gi;\n    private magnet_regex: RegExp = /magnet\\:\\?[^\\\"]+/gi;\n    private result: Result;\n    private ed2k_result: Array<string> = [];\n    private magnet_result: Array<string> = [];\n\n    constructor(){\n        this.init();\n\n        chrome.extension.onRequest.addListener(\n                (\n                    request: any, \n                    sender: chrome.runtime.MessageSender, \n                    sendResponse: (response: any) => void\n                ) => {\n                    this.onRequest(request, sender, sendResponse)\n                }\n            );\n    }\n\n    init() {\n        if (this.ed2k_regex.test(document.body.innerHTML) || this.magnet_regex.test(document.body.innerHTML)) {\n            this.getResult();\n    \n            chrome.extension.sendRequest(\n                { ask: \"p2plinks\", result: this.result }, \n                (response) => {\n\n                }\n            );\n        }\n    }\n\n    onRequest(request: any, sender: chrome.runtime.MessageSender, sendResponse: (response: any) => void) {\n        if (request.ask == \"getResult\") {\n            if (this.result) {\n                sendResponse({ result: this.result });\n            } else {\n                this.getResult();\n                sendResponse({ result: this.result });\n            }\n        }else if (request.ask == \"refreshResult\") {\n            this.getResult();\n            sendResponse({ result: this.result });\n        }\n    }\n\n    getResult() {\n        this.ed2k_result = document.body.innerHTML.match(this.ed2k_regex) || [];\n        this.magnet_result = document.body.innerHTML.match(this.magnet_regex) || [];\n        this.result = { ed2k_result: this.ed2k_result, magnet_result: this.magnet_result };\n    }\n}\n\nnew Content();"],"names":[],"mappings":";;;;;;;QASI;YAAA,iBAYC;YAlBO,eAAU,GAAW,0BAA0B,CAAC;YAChD,iBAAY,GAAW,oBAAoB,CAAC;YAE5C,gBAAW,GAAkB,EAAE,CAAC;YAChC,kBAAa,GAAkB,EAAE,CAAC;YAGtC,IAAI,CAAC,IAAI,EAAE,CAAC;YAEZ,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,WAAW,CAC9B,UACI,OAAY,EACZ,MAAoC,EACpC,YAAqC;gBAErC,KAAI,CAAC,SAAS,CAAC,OAAO,EAAE,MAAM,EAAE,YAAY,CAAC,CAAA;aAChD,CACJ,CAAC;SACT;QAED,sBAAI,GAAJ;YACI,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE;gBAClG,IAAI,CAAC,SAAS,EAAE,CAAC;gBAEjB,MAAM,CAAC,SAAS,CAAC,WAAW,CACxB,EAAE,GAAG,EAAE,UAAU,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,EACxC,UAAC,QAAQ;iBAER,CACJ,CAAC;aACL;SACJ;QAED,2BAAS,GAAT,UAAU,OAAY,EAAE,MAAoC,EAAE,YAAqC;YAC/F,IAAI,OAAO,CAAC,GAAG,IAAI,WAAW,EAAE;gBAC5B,IAAI,IAAI,CAAC,MAAM,EAAE;oBACb,YAAY,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;iBACzC;qBAAM;oBACH,IAAI,CAAC,SAAS,EAAE,CAAC;oBACjB,YAAY,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;iBACzC;aACJ;iBAAK,IAAI,OAAO,CAAC,GAAG,IAAI,eAAe,EAAE;gBACtC,IAAI,CAAC,SAAS,EAAE,CAAC;gBACjB,YAAY,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;aACzC;SACJ;QAED,2BAAS,GAAT;YACI,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;YACxE,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;YAC5E,IAAI,CAAC,MAAM,GAAG,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC;SACtF;QACL,cAAC;IAAD,CAAC,IAAA;IAED,IAAI,OAAO,EAAE,CAAC;;;;;;;;;;;;"}