{"version":3,"file":"background.js","sources":["../src/background/index.ts"],"sourcesContent":["import { Results } from \"../shared\";\n\nexport class BackGround {\n    private result: Results;\n\n    constructor() {\n        chrome.runtime.onMessage.addListener(\n            (request: any, sender: chrome.runtime.MessageSender, sendResponse: (response: any) => void) => {\n                this.onRequest(request, sender, sendResponse);\n            }\n        );\n\n        chrome.tabs.onSelectionChanged.addListener((id, obj) => {\n            chrome.tabs.sendRequest(id, { ask: \"getResult\" }, response => {\n                if (response) {\n                    this.result = response.result;\n                }\n            });\n        });\n    }\n\n    onRequest(request: any, sender: chrome.runtime.MessageSender, sendResponse: (response: any) => void) {\n        console.log(request);\n        if (request.ask === \"p2plinks\") {\n            this.showPopup(request.result, sender.tab.id);\n        }\n\n        var copyLinks = request.links.replace(/\\r\\n/g, \"\\\\\\\\r\\\\\\\\n\");\n\n        let writeCode = `\n            var sGetter = document.createElement(\"script\");\n            sGetter.type = \"application/javascript\";\n            sGetter.textContent = \"var r = setInterval(function()\" +\n                \"{ if(top.Core && top.Core.OFFL5Plug) {\" +\n                    \"top.Core.OFFL5Plug.OpenLink();\"+\n                    \"setTimeout(function() {\"+\n                        \"top.$('#js_offline_new_add').val(\\\\\"${copyLinks}\\\\\");\"+\n                    \"}, 10);\"+\n                    \"clearInterval(r);\" +\n                \"} },300);\";\n            document.body.appendChild(sGetter);\n        `;\n\n        // top.Core.OFFL5Plug.OpenLink();\n        // setTimeout(function() {\n        //     $('#js_offline_new_add').val(${copyLinks});\n        // }, 1);\n        // clearInterval(r);\n\n        if (request.ask === \"openTab\") {\n            chrome.tabs.create({ url: request.url }, tab => {\n                chrome.tabs.executeScript(tab.id, { code: writeCode }, () => {});\n            });\n        }\n    }\n\n    showPopup = function(result, id) {\n        this.result = result;\n        chrome.pageAction.show(id);\n    };\n}\n\nnew BackGround();\n"],"names":[],"mappings":";;;;;;;QAKI;YAmDA,cAAS,GAAG,UAAS,MAAM,EAAE,EAAE;gBAC3B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;gBACrB,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aAC9B,CAAC;YArDE,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,WAAW,CAChC,CAAC,OAAY,EAAE,MAAoC,EAAE,YAAqC;gBACtF,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;aACjD,CACJ,CAAC;YAEF,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,WAAW,CAAC,CAAC,EAAE,EAAE,GAAG;gBAC/C,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,WAAW,EAAE,EAAE,QAAQ;oBACtD,IAAI,QAAQ,EAAE;wBACV,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;qBACjC;iBACJ,CAAC,CAAC;aACN,CAAC,CAAC;SACN;QAED,SAAS,CAAC,OAAY,EAAE,MAAoC,EAAE,YAAqC;YAC/F,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YACrB,IAAI,OAAO,CAAC,GAAG,KAAK,UAAU,EAAE;gBAC5B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;aACjD;YAED,IAAI,SAAS,GAAG,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;YAE7D,IAAI,SAAS,GAAG;;;;;;;+DAOuC,SAAS;;;;;SAK/D,CAAC;;;;;;YAQF,IAAI,OAAO,CAAC,GAAG,KAAK,SAAS,EAAE;gBAC3B,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,OAAO,CAAC,GAAG,EAAE,EAAE,GAAG;oBACxC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,SAAQ,CAAC,CAAC;iBACpE,CAAC,CAAC;aACN;SACJ;KAMJ;IAED,IAAI,UAAU,EAAE,CAAC;;;;;;;;;;;;"}